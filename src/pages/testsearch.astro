---
import StarlightPage from '@astrojs/starlight/components/StarlightPage.astro'
import Searchbox from '../components/search/searchbox.astro'
import PalletGrid from '../components/PalletGrid.astro'
import ClickDropdownMenu_A from '../components/ClickDropdownMenu_A.astro'

const pageTitle = 'Test Search'

const defaultSpeechTitle = 'Click on the any of the famous orations listed above.'
const defaultSpeechTranscript = 'The full transcript will be displayed here. Use the Search box to dynamnically highlight any part of the transcript'
import {tw as rowStyles} from './api/speeches/index.js'
const tw = {
	introduction: {
		h3: 'text-center',
		h4: 'pt-8 pb-4 text-center',
		p: 'text-center font-semibold'	
	},
	table:'mx-auto my-4 max-w-max ',
	...rowStyles,
	hr: 'relative top-8 h-1 bg-zinc-200/50 dark:bg-blue-500/20',
  search:{
		container: 'not-content pt-12 ' +  
		'flex flex-nowrap justify-between items-center gap-2',
		colorPallet: 'colorPallet size-12 ' +
			'bg-indigo-600  dark:bg-gray-700 ' + 
			'border-2 border-gray-600',
		palletIcon: 'inline-block size-6' ,
		resetButton: 'px-4 py-3 cursor-pointer rounded-2xl ' + 
			'text-lg text-zinc-50 dark:text-zinc-300 ' +
			'bg-sky-600  dark:bg-indigo-600',
	},
	speech:{
		wrapper: 'not-content w-full mx-auto max-h-[50rem] overflow-y-auto rounded-t-lg ' + 
			'bg-gray-100 dark:bg-gray-950',
		title: 'p-4 text-center text-balance text-xl ' + 
			'text-indigo-900 dark:text-amber-100/80 ' + 
			'border-b-2 border-gray-200 dark:border-gray-700 ',
		transcript: 'p-4'
	},
}	
const hs = {
	resetButton:`
		on load or click 
			put the "${defaultSpeechTitle}" into the #{'speech-title'} then
			put the "${defaultSpeechTranscript}" into the #{'speech-transcript'} then 
			send reset to the <table#all-speeches/> 
			send reset to the #{'searchbox'}
			go to the #{'introduction'} smoothly
		end `,
	colorPallet: `
	  -- cache the bg-color-value in a data-* attribute of the div#search-wrapper 
		-- remove the old and install the newHilightColor into this attribute as a caching strategy
		-- set the value of a hidden <input> to the newHighlightColor so it can be grabbed by the regex matching code
		-- which then installs styled <mark> tags around all the matched strings
		on click 
      set originalHilightColor to the @data-hilight-color of the #{'search-wrapper'}
			remove .{originalHilightColor} from the #{'search-wrapper'}
			set newHilightColor to my @bgColor
			add .{newHilightColor} to #{'search-wrapper'}
			set the @data-hilight-color of the #{'search-wrapper'} to the newHilightColor
			set the value of the #{'hilight-color'} to the newHilightColor
			trigger update on the  #{'searchbox'}
		end
		`,
	table: `
		on reset
			remove .${tw.rowHilight} from <tr/>
		end `
}

---

<StarlightPage frontmatter={{title: pageTitle}}>

{/* Intro */}
<div id="introduction" class="w-10/12 mx-auto">
	<h3 class={tw.introduction.h3}>Famous Speeches in the English Language</h3>
	<h4 class={tw.introduction.h4}>Use the Search control below to highlight words from the most famous speeches that shaped  our world.</h4>
	<p class={tw.introduction.p}>Click to select any Speech from the list</p>
</div>

{/*  Table of Famous Speeches */}
<table class={tw.table}
				id="all-speeches"
				hx-trigger="load"  
				hx-get="/api/speeches/"
				hx-target="<tbody/>"
				hx-swap="innerHTML"
				script={hs.table}>
	<thead>
		<tr><th>Speaker</th><th>Title</th><th>Date</th></tr>
	</thead>
	<tbody></tbody>
</table>

<hr class={tw.hr}>
 
{/*  Search Box */}
<div class={tw.search.container}>
	<Searchbox 
		id="searchbox" 
		searchPath="/api/speeches/match/" 
		target="#speech-transcript" 
		swapStrategy="innerHTML"
		 />
	
	<ClickDropdownMenu_A 
		 id='click-activated-pallet' 
		 moveXY='-200,18'
		 buttonStyles={tw.search.colorPallet} 
		 duration='180ms'>
	 <img slot="leftIcon" src='/images/tailwind_icon.svg' alt='tailwind icon' class={tw.search.palletIcon}/>
	 <PalletGrid orientation='vertical' hs={hs.colorPallet}/>
 </ClickDropdownMenu_A>	 
		 
	<button class={tw.search.resetButton}
	script={hs.resetButton}
	>Reset</button>
</div>

{/* Our Speech */}
<div class={tw.speech.wrapper}>
	<h4 id="speech-title" class={tw.speech.title}></h4>
	<div id="speech-transcript" class={tw.speech.transcript}>
	</div>
</div>
	

</StarlightPage>
